import{c as se,j,p as A,q as N}from"./chunk-Z4SU7DYJ.js";import{a as oe}from"./chunk-AJCXHZIR.js";import{a as F}from"./chunk-6NT6GWZQ.js";import{c as te,e as ie,i as re,s as ne}from"./chunk-ACJALHG7.js";import{n as V,o as k,r as M}from"./chunk-RFLB7YYO.js";import{Ab as Y,B as q,Bb as Z,Ca as s,Cb as ee,Da as b,Eb as T,F as H,M as P,S,Wa as v,X as R,Ya as d,ba as E,e as D,eb as o,fb as n,gb as I,j as Q,ka as u,kb as C,la as p,mb as g,n as L,nb as l,o as h,r as $,rb as B,sa as W,sb as G,tb as X,vb as c,wb as J,xb as w,yb as K,z as x}from"./chunk-6FEQCYFL.js";var ae=(()=>{class t{http;baseApiUrl="https://servicodados.ibge.gov.br/api/v1/localidades/estados";constructor(e){this.http=e}normalizeString(e){return e.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase()}searchCities(e,r="MG"){if(!e||e.trim()==="")return L([]);let i=`${this.baseApiUrl}/${r}/municipios`;return this.http.get(i).pipe($(a=>{let y=this.normalizeString(e);return a.filter(m=>{let _=m.nome||"";return this.normalizeString(_).includes(y)}).map(m=>{let _=m.nome?.trim()||"Desconhecido",U=_.length>100?_.substring(0,100):_,de=m.microrregiao.mesorregiao.UF.sigla||"Desconhecido";return{id:m.id||0,name:U,state:de}}).slice(0,10)}),x(a=>(console.error("Erro ao buscar cidades:",a),L([]))))}static \u0275fac=function(r){return new(r||t)(R(F))};static \u0275prov=S({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var O=(()=>{class t{http;apiUrl=`${oe.apiUrl}/City`;constructor(e){this.http=e}addCity(e){if(!e.name||e.name.trim().length===0)return h(()=>new Error("O nome da cidade \xE9 obrigat\xF3rio."));if(e.name.length>100)return h(()=>new Error("O nome da cidade deve ter no m\xE1ximo 100 caracteres."));if(!e.state||e.state.trim().length===0)return h(()=>new Error("O estado (UF) \xE9 obrigat\xF3rio."));if(e.state.length!==2)return h(()=>new Error("O estado (UF) deve ter exatamente 2 caracteres."));let r={Id:e.id,Name:e.name,State:e.state};return this.http.post(this.apiUrl,r).pipe(x(i=>i.status===409?h(()=>new Error("Essa cidade j\xE1 est\xE1 cadastrada.")):i.status===400?h(()=>new Error(i.error)):h(()=>new Error("Erro ao adicionar cidade."))))}getAllCities(){return this.http.get(this.apiUrl)}removeCity(e){return this.http.delete(`${this.apiUrl}/${e}`).pipe(x(r=>r.status===404?h(()=>new Error("Cidade n\xE3o encontrada.")):h(()=>new Error("Erro ao remover cidade."))))}static \u0275fac=function(r){return new(r||t)(R(F))};static \u0275prov=S({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var he=["searchRef"];function ge(t,f){if(t&1){let e=C();o(0,"li",8),g("click",function(){let i=u(e).$implicit,a=l(2);return p(a.handleSelectCity(i))}),c(1),n()}if(t&2){let e=f.$implicit;s(),K(" ",e.name,", ",e.state," ")}}function ve(t,f){if(t&1&&(o(0,"ul",6),v(1,ge,2,2,"li",7),n()),t&2){let e=l();s(),d("ngForOf",e.searchResults)}}function Ce(t,f){if(t&1){let e=C();o(0,"div",9)(1,"div",10)(2,"p",11),c(3),n(),o(4,"button",12),g("click",function(){u(e);let i=l();return p(i.confirmAddCity())}),c(5," Sim "),n(),o(6,"button",13),g("click",function(){u(e);let i=l();return p(i.cancelAddCity())}),c(7," N\xE3o "),n()()()}if(t&2){let e=l();s(3),w(" Adicionar ",e.selectedCity==null?null:e.selectedCity.name," \xE0 lista? ")}}var le=(()=>{class t{ibgeService;cityService;addCity=new W;query="";searchResults=[];isResultsVisible=!1;selectedCity=null;showConfirmation=!1;searchIcon=j;searchRef;searchSubject=new Q;subscription=new D;constructor(e,r){this.ibgeService=e,this.cityService=r}ngOnInit(){this.subscription.add(this.searchSubject.pipe(q(300),H(),P(e=>this.ibgeService.searchCities(e))).subscribe(e=>{this.searchResults=e,this.isResultsVisible=e.length>0})),document.addEventListener("mousedown",this.handleClickOutside.bind(this))}handleQueryChange(e){let r=e.target.value;this.query=r,this.searchSubject.next(r)}handleSelectCity(e){this.selectedCity=e,this.showConfirmation=!0,this.isResultsVisible=!1}confirmAddCity(){this.selectedCity&&this.cityService.addCity(this.selectedCity).subscribe({next:e=>{this.addCity.emit(e),this.query="",this.searchResults=[],this.isResultsVisible=!1,this.selectedCity=null,this.showConfirmation=!1,alert(`${e.name} foi adicionada com sucesso!`)},error:e=>{console.error("Erro ao adicionar cidade:",e);let r=e.status===409?"Essa cidade j\xE1 est\xE1 cadastrada.":e.message||"Erro ao adicionar cidade. Tente novamente.";alert(r),this.showConfirmation=!1,this.selectedCity=null}})}cancelAddCity(){this.selectedCity=null,this.showConfirmation=!1}handleFocus(){this.searchResults.length>0&&(this.isResultsVisible=!0)}handleClickOutside(e){this.searchRef&&!this.searchRef.nativeElement.contains(e.target)&&(this.isResultsVisible=!1)}ngOnDestroy(){document.removeEventListener("mousedown",this.handleClickOutside.bind(this)),this.subscription.unsubscribe()}static \u0275fac=function(r){return new(r||t)(b(ae),b(O))};static \u0275cmp=E({type:t,selectors:[["app-city-search"]],viewQuery:function(r,i){if(r&1&&B(he,5),r&2){let a;G(a=X())&&(i.searchRef=a.first)}},outputs:{addCity:"addCity"},standalone:!0,features:[T],decls:6,vars:4,consts:[["searchRef",""],[1,"relative","w-80","mx-auto"],[1,"absolute","left-3","top-1/2","-translate-y-1/2","text-emerald-600","w-4","h-4","pointer-events-none",3,"name"],["type","text","placeholder","Digite o nome da cidade",1,"w-full","pl-10","pr-3","py-2","border","border-gray-300","rounded-md","focus:outline-none","focus:ring-2","focus:ring-emerald-500","transition-all","duration-200",3,"ngModelChange","input","focus","ngModel"],["class","absolute top-full left-0 right-0 bg-white border border-gray-300 rounded-md shadow-lg max-h-48 overflow-y-auto z-10 list-none p-0 m-0",4,"ngIf"],["class","fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50",4,"ngIf"],[1,"absolute","top-full","left-0","right-0","bg-white","border","border-gray-300","rounded-md","shadow-lg","max-h-48","overflow-y-auto","z-10","list-none","p-0","m-0"],["class","p-2 cursor-pointer hover:bg-gray-100 transition-colors duration-150",3,"click",4,"ngFor","ngForOf"],[1,"p-2","cursor-pointer","hover:bg-gray-100","transition-colors","duration-150",3,"click"],[1,"fixed","inset-0","bg-black","bg-opacity-50","flex","justify-center","items-center","z-50"],[1,"bg-white","p-6","rounded-md","shadow-lg","text-center"],[1,"mb-4","text-gray-700"],[1,"bg-emerald-500","text-white","px-4","py-2","rounded-md","mr-2","hover:bg-emerald-600","transition-colors","duration-150",3,"click"],[1,"bg-red-500","text-white","px-4","py-2","rounded-md","hover:bg-red-600","transition-colors","duration-150",3,"click"]],template:function(r,i){if(r&1){let a=C();o(0,"div",1,0),I(2,"lucide-icon",2),o(3,"input",3),ee("ngModelChange",function(m){return u(a),Z(i.query,m)||(i.query=m),p(m)}),g("input",function(m){return u(a),p(i.handleQueryChange(m))})("focus",function(){return u(a),p(i.handleFocus())}),n(),v(4,ve,2,1,"ul",4)(5,Ce,8,1,"div",5),n()}r&2&&(s(2),d("name",i.searchIcon),s(),Y("ngModel",i.query),s(),d("ngIf",i.isResultsVisible),s(),d("ngIf",i.showConfirmation))},dependencies:[ne,te,ie,re,M,V,k,N,A],encapsulation:2})}return t})();function ye(t,f){t&1&&(o(0,"div",13),c(1," Carregando cidades... "),n())}function _e(t,f){if(t&1&&(o(0,"div",14),c(1),n()),t&2){let e=l();s(),w(" ",e.errorMessage," ")}}function xe(t,f){t&1&&(o(0,"div",15),c(1," Nenhuma cidade adicionada "),n())}function be(t,f){if(t&1){let e=C();o(0,"li",18)(1,"button",19),g("click",function(){let i=u(e).$implicit,a=l(2);return p(a.initiateRemoveCity(i))}),I(2,"lucide-icon",20),n(),o(3,"span",21),c(4),n()()}if(t&2){let e=f.$implicit,r=l(2);s(2),d("name",r.removeIcon),s(2),J(e.name)}}function we(t,f){if(t&1&&(o(0,"ul",16),v(1,be,5,2,"li",17),n()),t&2){let e=l();s(),d("ngForOf",e.servingCities)}}function Se(t,f){if(t&1){let e=C();o(0,"div",22)(1,"div",23)(2,"p",24),c(3),n(),o(4,"button",25),g("click",function(){u(e);let i=l();return p(i.confirmRemoveCity())}),c(5," Sim "),n(),o(6,"button",26),g("click",function(){u(e);let i=l();return p(i.cancelRemoveCity())}),c(7," N\xE3o "),n()()()}if(t&2){let e=l();s(3),w(" Remover ",e.cityToRemove==null?null:e.cityToRemove.name," da lista? ")}}var He=(()=>{class t{cityService;servingCities=[];isLoading=!1;errorMessage=null;showRemoveConfirmation=!1;cityToRemove=null;serchIcon=j;removeIcon=se;constructor(e){this.cityService=e}ngOnInit(){this.loadServingCities()}loadServingCities(){this.isLoading=!0,this.errorMessage=null,this.cityService.getAllCities().subscribe({next:e=>{this.servingCities=e,this.isLoading=!1},error:e=>{console.error("Erro ao carregar cidades:",e),this.isLoading=!1,this.errorMessage=e.status===0?"N\xE3o foi poss\xEDvel conectar ao servidor. Verifique se o servidor est\xE1 ativo e se a URL est\xE1 correta (HTTP/HTTPS).":"N\xE3o foi poss\xEDvel carregar as cidades. Tente novamente mais tarde."}})}handleAddCity(e){this.loadServingCities()}initiateRemoveCity(e){this.cityToRemove=e,this.showRemoveConfirmation=!0}confirmRemoveCity(){this.cityToRemove&&this.cityService.removeCity(this.cityToRemove.id).subscribe({next:()=>{this.loadServingCities(),this.showRemoveConfirmation=!1,this.cityToRemove=null,alert("Cidade removida com sucesso!")},error:e=>{console.error("Erro ao remover cidade:",e),alert(e.message||"Erro ao remover cidade. Tente novamente."),this.showRemoveConfirmation=!1,this.cityToRemove=null}})}cancelRemoveCity(){this.showRemoveConfirmation=!1,this.cityToRemove=null}static \u0275fac=function(r){return new(r||t)(b(O))};static \u0275cmp=E({type:t,selectors:[["app-regions"]],standalone:!0,features:[T],decls:15,vars:5,consts:[[1,"pt-28","px-8","pb-8"],[1,"flex-1","max-w-5xl","ml-64","pt-20","pb-8","px-4"],[1,"mb-8","text-center"],[1,"text-xl","font-semibold","text-[var(--dark-green)]"],[1,"mb-8","flex","justify-center"],[3,"addCity"],[1,"bg-[var(--white)]","rounded-lg","shadow-sm","p-5"],[1,"text-center","text-md","font-medium","text-[var(--dark-green)]","mb-4"],["class","text-[var(--gray)] text-center py-4",4,"ngIf"],["class","text-red-500 text-center py-4",4,"ngIf"],["class","text-[var(--gray)] text-center py-8",4,"ngIf"],["class","grid grid-cols-1 md:grid-cols-3 gap-4",4,"ngIf"],["class","fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50",4,"ngIf"],[1,"text-[var(--gray)]","text-center","py-4"],[1,"text-red-500","text-center","py-4"],[1,"text-[var(--gray)]","text-center","py-8"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-4"],["class","flex items-center space-x-2 p-2",4,"ngFor","ngForOf"],[1,"flex","items-center","space-x-2","p-2"],[1,"text-[var(--green-1)]","hover:text-[var(--green-3)]","transition-colors","duration-150",3,"click"],[1,"w-5","h-5",3,"name"],[1,"text-[var(--gray)]"],[1,"fixed","inset-0","bg-black","bg-opacity-50","flex","justify-center","items-center","z-50"],[1,"bg-[var(--white)]","p-6","rounded-md","shadow-lg","text-center"],[1,"mb-4","text-[var(--gray)]"],[1,"bg-red-500","text-[var(--white)]","px-4","py-2","rounded-md","mr-2","hover:bg-red-600","transition-colors","duration-150",3,"click"],[1,"bg-[var(--gray)]","text-[var(--white)]","px-4","py-2","rounded-md","hover:bg-gray-700","transition-colors","duration-150",3,"click"]],template:function(r,i){r&1&&(o(0,"main",0)(1,"div",1)(2,"div",2)(3,"h2",3),c(4," Adi\xE7\xE3o de cidades "),n()(),o(5,"div",4)(6,"app-city-search",5),g("addCity",function(y){return i.handleAddCity(y)}),n()(),o(7,"div",6)(8,"h3",7),c(9," Cidades Atendidas "),n(),v(10,ye,2,0,"div",8)(11,_e,2,1,"div",9)(12,xe,2,0,"div",10)(13,we,2,1,"ul",11),n(),v(14,Se,8,1,"div",12),n()()),r&2&&(s(10),d("ngIf",i.isLoading),s(),d("ngIf",i.errorMessage),s(),d("ngIf",!i.isLoading&&!i.errorMessage&&i.servingCities.length===0),s(),d("ngIf",!i.isLoading&&!i.errorMessage&&i.servingCities.length>0),s(),d("ngIf",i.showRemoveConfirmation))},dependencies:[le,M,V,k,N,A],encapsulation:2})}return t})();export{He as RegionsComponent};
