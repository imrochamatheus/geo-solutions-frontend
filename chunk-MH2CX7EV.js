import{e as g}from"./chunk-U4MZYTGD.js";import{a as p}from"./chunk-AJCXHZIR.js";import{b as h}from"./chunk-KCOFYTGJ.js";import{L as l,P as d,U as u,g as c}from"./chunk-URY3LSMO.js";var i=class extends Error{};i.prototype.name="InvalidTokenError";function m(r){return decodeURIComponent(atob(r).replace(/(.)/g,(o,e)=>{let t=e.charCodeAt(0).toString(16).toUpperCase();return t.length<2&&(t="0"+t),"%"+t}))}function f(r){let o=r.replace(/-/g,"+").replace(/_/g,"/");switch(o.length%4){case 0:break;case 2:o+="==";break;case 3:o+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return m(o)}catch{return atob(o)}}function s(r,o){if(typeof r!="string")throw new i("Invalid token specified: must be a string");o||(o={});let e=o.header===!0?0:1,t=r.split(".")[e];if(typeof t!="string")throw new i(`Invalid token specified: missing part #${e+1}`);let n;try{n=f(t)}catch(a){throw new i(`Invalid token specified: invalid base64 for part #${e+1} (${a.message})`)}try{return JSON.parse(n)}catch(a){throw new i(`Invalid token specified: invalid json for part #${e+1} (${a.message})`)}}var I=(()=>{class r{http;router;apiUrl=p.apiUrl;tokenKey="auth_token";userSubject=new c(this.getToken());usernameSubject=new c(this.getUsernameFromToken());constructor(e,t){this.http=e,this.router=t}getToken(){return localStorage.getItem(this.tokenKey)}setToken(e){localStorage.setItem(this.tokenKey,e),this.userSubject.next(e)}saveToken(e){this.setToken(e)}signin(e){return this.http.post(`${this.apiUrl}/Users/login`,e).pipe(l(t=>{t&&t.jwtToken&&this.setToken(t.jwtToken)}))}autoLogin(){let e=this.getToken();e&&this.userSubject.next(e)}logout(){localStorage.removeItem(this.tokenKey),this.userSubject.next(null),this.router.navigate(["/auth"])}getDecodedJwt(){let e=this.getToken();if(!e)return null;try{return s(e)}catch(t){return console.error("Error decoding JWT token:",t),null}}isAuthenticated(){let e=this.getToken();if(!e)return console.debug("No token found in localStorage"),!1;try{let t=s(e),n=t.exp*1e3>Date.now();return console.debug("Token validity:",n,"Expiration:",new Date(t.exp*1e3)),n}catch{return console.debug("Invalid token format"),!1}}getUserRole(){return this.getDecodedJwt()?.role||null}getUsername(){return this.getDecodedJwt()?.username||null}isAdmin(){return this.getUserRole()?.toLowerCase()==="admin"}getUsernameFromToken(){return this.getDecodedJwt()?.username||null}getUserIdFromToken(){let e=this.getToken();if(!e)return null;let t=s(e),n=Number(t.nameid);return isNaN(n)?null:n}static \u0275fac=function(t){return new(t||r)(u(h),u(g))};static \u0275prov=d({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();export{s as a,I as b};
