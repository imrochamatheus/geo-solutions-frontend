import{a as M}from"./chunk-PUKELLXA.js";import{D as V,E as k,e as ne,v as I}from"./chunk-LWWUDTLH.js";import{c as Z,e as ee,i as te,v as ie}from"./chunk-57VEO5ZA.js";import"./chunk-AJCXHZIR.js";import{b as Y}from"./chunk-KCOFYTGJ.js";import{n as R,o as E,s as T}from"./chunk-JOQ4QRTS.js";import{Bb as c,C as D,Cb as B,Da as s,Db as x,Ea as _,Eb as G,Gb as X,Hb as J,Ib as K,J as Q,Kb as S,P as q,U,Ya as h,_ as b,_a as d,a as j,f as L,gb as o,hb as r,ia as u,ib as w,ja as p,k as F,mb as v,o as N,qb as g,rb as l,sa as $,vb as H,w as z,wb as P,xb as W,y as O}from"./chunk-URY3LSMO.js";import"./chunk-TMC7WMLO.js";var oe=(()=>{class t{http;baseApiUrl="https://servicodados.ibge.gov.br/api/v1/localidades/estados";constructor(e){this.http=e}normalizeString(e){return e.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase()}searchCities(e,n="MG"){if(!e||e.trim()==="")return F([]);let i=`${this.baseApiUrl}/${n}/municipios`;return this.http.get(i).pipe(N(a=>{let y=this.normalizeString(e);return a.filter(m=>{let C=m.nome||"";return this.normalizeString(C).includes(y)}).map(m=>{let C=m.nome?.trim()||"Desconhecido",A=C.length>100?C.substring(0,100):C,ae=m.microrregiao.mesorregiao.UF.sigla||"Desconhecido";return{id:m.id||0,name:A,state:ae}}).slice(0,10)}),z(a=>(console.error("Erro ao buscar cidades:",a),F([]))))}static \u0275fac=function(n){return new(n||t)(U(Y))};static \u0275prov=q({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var ue=["searchRef"];function pe(t,f){if(t&1){let e=v();o(0,"li",8),g("click",function(){let i=u(e).$implicit,a=l(2);return p(a.handleSelectCity(i))}),c(1),r()}if(t&2){let e=f.$implicit;s(),G(" ",e.name,", ",e.state," ")}}function fe(t,f){if(t&1&&(o(0,"ul",6),h(1,pe,2,2,"li",7),r()),t&2){let e=l();s(),d("ngForOf",e.searchResults)}}function ge(t,f){if(t&1){let e=v();o(0,"div",9)(1,"div",10)(2,"p",11),c(3),r(),o(4,"button",12),g("click",function(){u(e);let i=l();return p(i.confirmAddCity())}),c(5," Sim "),r(),o(6,"button",13),g("click",function(){u(e);let i=l();return p(i.cancelAddCity())}),c(7," N\xE3o "),r()()()}if(t&2){let e=l();s(3),x(" Adicionar ",e.selectedCity==null?null:e.selectedCity.name," \xE0 lista? ")}}var se=(()=>{class t{ibgeService;cityService;addCity=new $;query="";searchResults=[];isResultsVisible=!1;selectedCity=null;showConfirmation=!1;searchIcon=I;searchRef;searchSubject=new L;subscription=new j;constructor(e,n){this.ibgeService=e,this.cityService=n}ngOnInit(){this.subscription.add(this.searchSubject.pipe(O(300),D(),Q(e=>this.ibgeService.searchCities(e))).subscribe(e=>{this.searchResults=e,this.isResultsVisible=e.length>0})),document.addEventListener("mousedown",this.handleClickOutside.bind(this))}handleQueryChange(e){let n=e.target.value;this.query=n,this.searchSubject.next(n)}handleSelectCity(e){this.selectedCity=e,this.showConfirmation=!0,this.isResultsVisible=!1}confirmAddCity(){this.selectedCity&&this.cityService.addCity(this.selectedCity).subscribe({next:e=>{this.addCity.emit(e),this.query="",this.searchResults=[],this.isResultsVisible=!1,this.selectedCity=null,this.showConfirmation=!1,alert(`${e.name} foi adicionada com sucesso!`)},error:e=>{console.error("Erro ao adicionar cidade:",e);let n=e.status===409?"Essa cidade j\xE1 est\xE1 cadastrada.":e.message||"Erro ao adicionar cidade. Tente novamente.";alert(n),this.showConfirmation=!1,this.selectedCity=null}})}cancelAddCity(){this.selectedCity=null,this.showConfirmation=!1}handleFocus(){this.searchResults.length>0&&(this.isResultsVisible=!0)}handleClickOutside(e){this.searchRef&&!this.searchRef.nativeElement.contains(e.target)&&(this.isResultsVisible=!1)}ngOnDestroy(){document.removeEventListener("mousedown",this.handleClickOutside.bind(this)),this.subscription.unsubscribe()}static \u0275fac=function(n){return new(n||t)(_(oe),_(M))};static \u0275cmp=b({type:t,selectors:[["app-city-search"]],viewQuery:function(n,i){if(n&1&&H(ue,5),n&2){let a;P(a=W())&&(i.searchRef=a.first)}},outputs:{addCity:"addCity"},standalone:!0,features:[S],decls:6,vars:4,consts:[["searchRef",""],[1,"relative","w-80","mx-auto"],[1,"absolute","left-3","top-1/2","-translate-y-1/2","text-emerald-600","w-4","h-4","pointer-events-none",3,"name"],["type","text","placeholder","Digite o nome da cidade",1,"w-full","pl-10","pr-3","py-2","border","border-gray-300","rounded-md","focus:outline-none","focus:ring-2","focus:ring-emerald-500","transition-all","duration-200",3,"ngModelChange","input","focus","ngModel"],["class","absolute top-full left-0 right-0 bg-white border border-gray-300 rounded-md shadow-lg max-h-48 overflow-y-auto z-10 list-none p-0 m-0",4,"ngIf"],["class","fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50",4,"ngIf"],[1,"absolute","top-full","left-0","right-0","bg-white","border","border-gray-300","rounded-md","shadow-lg","max-h-48","overflow-y-auto","z-10","list-none","p-0","m-0"],["class","p-2 cursor-pointer hover:bg-gray-100 transition-colors duration-150",3,"click",4,"ngFor","ngForOf"],[1,"p-2","cursor-pointer","hover:bg-gray-100","transition-colors","duration-150",3,"click"],[1,"fixed","inset-0","bg-black","bg-opacity-50","flex","justify-center","items-center","z-50"],[1,"bg-white","p-6","rounded-md","shadow-lg","text-center"],[1,"mb-4","text-gray-700"],[1,"bg-emerald-500","text-white","px-4","py-2","rounded-md","mr-2","hover:bg-emerald-600","transition-colors","duration-150",3,"click"],[1,"bg-red-500","text-white","px-4","py-2","rounded-md","hover:bg-red-600","transition-colors","duration-150",3,"click"]],template:function(n,i){if(n&1){let a=v();o(0,"div",1,0),w(2,"lucide-icon",2),o(3,"input",3),K("ngModelChange",function(m){return u(a),J(i.query,m)||(i.query=m),p(m)}),g("input",function(m){return u(a),p(i.handleQueryChange(m))})("focus",function(){return u(a),p(i.handleFocus())}),r(),h(4,fe,2,1,"ul",4)(5,ge,8,1,"div",5),r()}n&2&&(s(2),d("name",i.searchIcon),s(),X("ngModel",i.query),s(),d("ngIf",i.isResultsVisible),s(),d("ngIf",i.showConfirmation))},dependencies:[ie,Z,ee,te,T,R,E,k,V],encapsulation:2})}return t})();function he(t,f){t&1&&(o(0,"div",13),c(1," Carregando cidades... "),r())}function ve(t,f){if(t&1&&(o(0,"div",14),c(1),r()),t&2){let e=l();s(),x(" ",e.errorMessage," ")}}function ye(t,f){t&1&&(o(0,"div",15),c(1," Nenhuma cidade adicionada "),r())}function Ce(t,f){if(t&1){let e=v();o(0,"li",18)(1,"button",19),g("click",function(){let i=u(e).$implicit,a=l(2);return p(a.initiateRemoveCity(i))}),w(2,"lucide-icon",20),r(),o(3,"span",21),c(4),r()()}if(t&2){let e=f.$implicit,n=l(2);s(2),d("name",n.removeIcon),s(2),B(e.name)}}function _e(t,f){if(t&1&&(o(0,"ul",16),h(1,Ce,5,2,"li",17),r()),t&2){let e=l();s(),d("ngForOf",e.servingCities)}}function xe(t,f){if(t&1){let e=v();o(0,"div",22)(1,"div",23)(2,"p",24),c(3),r(),o(4,"button",25),g("click",function(){u(e);let i=l();return p(i.confirmRemoveCity())}),c(5," Sim "),r(),o(6,"button",26),g("click",function(){u(e);let i=l();return p(i.cancelRemoveCity())}),c(7," N\xE3o "),r()()()}if(t&2){let e=l();s(3),x(" Remover ",e.cityToRemove==null?null:e.cityToRemove.name," da lista? ")}}var De=(()=>{class t{cityService;servingCities=[];isLoading=!1;errorMessage=null;showRemoveConfirmation=!1;cityToRemove=null;serchIcon=I;removeIcon=ne;constructor(e){this.cityService=e}ngOnInit(){this.loadServingCities()}loadServingCities(){this.isLoading=!0,this.errorMessage=null,this.servingCities=[],this.cityService.getAllCities().subscribe({next:e=>{this.servingCities=e,this.isLoading=!1},error:e=>{console.error("Erro ao carregar cidades:",e),this.isLoading=!1,this.errorMessage=e.status===0?"N\xE3o foi poss\xEDvel conectar ao servidor. Verifique se o servidor est\xE1 ativo e se a URL est\xE1 correta (HTTP/HTTPS).":"N\xE3o foi poss\xEDvel carregar as cidades. Tente novamente mais tarde."}})}handleAddCity(e){this.loadServingCities()}initiateRemoveCity(e){this.cityToRemove=e,this.showRemoveConfirmation=!0}confirmRemoveCity(){this.cityToRemove&&this.cityService.removeCity(this.cityToRemove.id).subscribe({next:()=>{this.loadServingCities(),this.showRemoveConfirmation=!1,this.cityToRemove=null,alert("Cidade removida com sucesso!")},error:e=>{console.error("Erro ao remover cidade:",e),alert(e.message||"Erro ao remover cidade. Tente novamente."),this.showRemoveConfirmation=!1,this.cityToRemove=null}})}cancelRemoveCity(){this.showRemoveConfirmation=!1,this.cityToRemove=null}static \u0275fac=function(n){return new(n||t)(_(M))};static \u0275cmp=b({type:t,selectors:[["app-regions"]],standalone:!0,features:[S],decls:15,vars:5,consts:[[1,"pt-28","px-8","pb-8"],[1,"flex-1","max-w-5xl","ml-64","pt-20","pb-8","px-4"],[1,"mb-8","text-center"],[1,"text-xl","font-semibold","text-[var(--dark-green)]"],[1,"mb-8","flex","justify-center"],[3,"addCity"],[1,"bg-[var(--white)]","rounded-lg","shadow-sm","p-5"],[1,"text-center","text-md","font-medium","text-[var(--dark-green)]","mb-4"],["class","text-[var(--gray)] text-center py-4",4,"ngIf"],["class","text-red-500 text-center py-4",4,"ngIf"],["class","text-[var(--gray)] text-center py-8",4,"ngIf"],["class","grid grid-cols-1 md:grid-cols-3 gap-4",4,"ngIf"],["class","fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50",4,"ngIf"],[1,"text-[var(--gray)]","text-center","py-4"],[1,"text-red-500","text-center","py-4"],[1,"text-[var(--gray)]","text-center","py-8"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-4"],["class","flex items-center space-x-2 p-2",4,"ngFor","ngForOf"],[1,"flex","items-center","space-x-2","p-2"],[1,"text-[var(--green-1)]","hover:text-[var(--green-3)]","transition-colors","duration-150",3,"click"],[1,"w-5","h-5",3,"name"],[1,"text-[var(--gray)]"],[1,"fixed","inset-0","bg-black","bg-opacity-50","flex","justify-center","items-center","z-50"],[1,"bg-[var(--white)]","p-6","rounded-md","shadow-lg","text-center"],[1,"mb-4","text-[var(--gray)]"],[1,"bg-red-500","text-[var(--white)]","px-4","py-2","rounded-md","mr-2","hover:bg-red-600","transition-colors","duration-150",3,"click"],[1,"bg-[var(--gray)]","text-[var(--white)]","px-4","py-2","rounded-md","hover:bg-gray-700","transition-colors","duration-150",3,"click"]],template:function(n,i){n&1&&(o(0,"main",0)(1,"div",1)(2,"div",2)(3,"h2",3),c(4," Adi\xE7\xE3o de cidades "),r()(),o(5,"div",4)(6,"app-city-search",5),g("addCity",function(y){return i.handleAddCity(y)}),r()(),o(7,"div",6)(8,"h3",7),c(9," Cidades Atendidas "),r(),h(10,he,2,0,"div",8)(11,ve,2,1,"div",9)(12,ye,2,0,"div",10)(13,_e,2,1,"ul",11),r(),h(14,xe,8,1,"div",12),r()()),n&2&&(s(10),d("ngIf",i.isLoading),s(),d("ngIf",i.errorMessage),s(),d("ngIf",!i.isLoading&&!i.errorMessage&&i.servingCities.length===0),s(),d("ngIf",!i.isLoading&&!i.errorMessage&&i.servingCities.length>0),s(),d("ngIf",i.showRemoveConfirmation))},dependencies:[se,T,R,E,k,V],encapsulation:2})}return t})();export{De as RegionsComponent};
