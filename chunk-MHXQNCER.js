import{b as B}from"./chunk-MH2CX7EV.js";import{e as q}from"./chunk-U4MZYTGD.js";import{c as k,d,e as T,f as j,g as x,h as g,j as $,m as V,n as G,v as J,w as L}from"./chunk-57VEO5ZA.js";import{a as z}from"./chunk-AJCXHZIR.js";import{b as N}from"./chunk-KCOFYTGJ.js";import{o as U,s as D}from"./chunk-JOQ4QRTS.js";import{Bb as s,Cb as p,Da as l,Db as w,Ea as h,Kb as A,P as C,U as E,Ya as b,_ as P,_a as m,gb as r,hb as o,ia as _,ib as c,ja as I,mb as M,qb as v,rb as f}from"./chunk-URY3LSMO.js";import"./chunk-TMC7WMLO.js";var R=(()=>{class i{http;apiUrl=z.apiUrl;constructor(e){this.http=e}getUserById(e){return this.http.get(`${this.apiUrl}/Users/${e}`)}updateUser(e){return this.http.put(`${this.apiUrl}/Users/edit-user`,e)}changePassword(e){return this.http.put(`${this.apiUrl}/Users/change-password`,e)}static \u0275fac=function(n){return new(n||i)(E(N))};static \u0275prov=C({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();function O(i,S){if(i&1&&(r(0,"div",18),s(1),o()),i&2){let e=f();l(),w(" ",e.successMessage," ")}}function W(i,S){if(i&1&&(r(0,"div",19),s(1),o()),i&2){let e=f();l(),w(" ",e.errorMessage," ")}}function K(i,S){if(i&1){let e=M();r(0,"div",20)(1,"h4",21),s(2,"Alterar Senha"),o(),r(3,"form",5),v("ngSubmit",function(){_(e);let t=f();return I(t.submitPassword())}),r(4,"div")(5,"label",22),s(6,"Senha Atual"),o(),r(7,"div",7),c(8,"input",23),r(9,"small",9),s(10),o()()(),r(11,"div")(12,"label",24),s(13,"Nova Senha"),o(),r(14,"div",7),c(15,"input",25),r(16,"small",9),s(17),o()()(),r(18,"div",26)(19,"button",16),s(20," Confirmar Altera\xE7\xE3o "),o()()()()}if(i&2){let e=f();l(3),m("formGroup",e.passwordForm),l(7),p(e.getFieldError("currentPassword",e.passwordForm)),l(7),p(e.getFieldError("newPassword",e.passwordForm)),l(2),m("disabled",e.passwordForm.invalid)}}var ne=(()=>{class i{userService;authService;router;profileForm;passwordForm;errorMessage=null;successMessage=null;showPasswordForm=!1;constructor(e,n,t){this.userService=e,this.authService=n,this.router=t,this.profileForm=new x({name:new g("",[d.minLength(2)]),email:new g("",[d.email]),cell:new g("",[d.pattern(/^\(?\d{2}\)?\s?9\d{4}-?\d{4}$/)])}),this.passwordForm=new x({currentPassword:new g("",[d.required,d.minLength(8)]),newPassword:new g("",[d.required,d.minLength(8),d.pattern(/^(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$/)])})}ngOnInit(){this.loadUserData()}loadUserData(){let e=this.authService.getDecodedJwt();if(console.debug("Decoded JWT:",e),e&&e.nameid){let n=+e.nameid;console.debug("Loading user data for ID:",n),this.userService.getUserById(n).subscribe({next:t=>{console.debug("User data loaded:",t),this.profileForm.patchValue({name:t.name,email:t.email,cell:t.cell})},error:t=>{this.errorMessage="Erro ao carregar os dados do usu\xE1rio.",console.error("Error loading user data:",t),t.status===401&&(this.authService.logout(),this.router.navigate(["/auth/signin"]))}})}else this.errorMessage="Usu\xE1rio n\xE3o autenticado.",this.authService.logout(),this.router.navigate(["/auth/signin"])}getFieldError(e,n=this.profileForm){let t=n.get(e),a="";return!t?.touched||!t?.dirty||(t?.hasError("required")?a="Campo obrigat\xF3rio":t?.hasError("email")?a="Deve possuir um e-mail v\xE1lido":t?.hasError("minlength")?a=`Deve ter no m\xEDnimo ${t.errors?.minlength.requiredLength} caracteres`:t?.hasError("pattern")&&(e==="cell"?a="N\xFAmero de celular inv\xE1lido. Ex: (31) 98888-8888":e==="newPassword"&&(a="A senha deve conter pelo menos uma letra mai\xFAscula, um n\xFAmero e um caractere especial."))),a}togglePasswordForm(){this.showPasswordForm=!this.showPasswordForm,this.showPasswordForm||(this.passwordForm.reset(),this.errorMessage=null,this.successMessage=null)}submitProfile(){if(this.profileForm.invalid){this.profileForm.markAllAsTouched();return}this.errorMessage=null,this.successMessage=null;let e=this.authService.getDecodedJwt();if(e&&e.nameid){let t={id:+e.nameid,userType:1},a=this.profileForm.get("name")?.value??void 0,y=this.profileForm.get("email")?.value??void 0,F=this.profileForm.get("cell")?.value??void 0;a&&(t.name=a),y&&(t.email=y),F&&(t.cell=F),this.userService.updateUser(t).subscribe({next:u=>{u&&u.jwtToken&&this.authService.saveToken(u.jwtToken),this.successMessage="Dados do perfil atualizados com sucesso!"},error:u=>{this.errorMessage=u.error||"Erro ao atualizar o perfil.",console.error("Error updating profile:",u),u.status===401&&(this.authService.logout(),this.router.navigate(["/auth/signin"]))}})}else this.errorMessage="Usu\xE1rio n\xE3o autenticado.",this.authService.logout(),this.router.navigate(["/auth/signin"])}submitPassword(){if(this.passwordForm.invalid){this.passwordForm.markAllAsTouched();return}this.errorMessage=null,this.successMessage=null;let e=this.passwordForm.get("currentPassword")?.value,n=this.passwordForm.get("newPassword")?.value;if(!e||!n){this.errorMessage="Por favor, preencha ambos os campos de senha.";return}let t={currentPassword:e,newPassword:n};this.userService.changePassword(t).subscribe({next:()=>{this.successMessage="Senha alterada com sucesso! Fa\xE7a login novamente.",this.passwordForm.reset(),this.showPasswordForm=!1,this.authService.logout(),this.router.navigate(["/auth/signin"])},error:a=>{this.errorMessage=a.error||"Erro ao alterar a senha.",console.error("Error changing password:",a),a.status===401&&(this.authService.logout(),this.router.navigate(["/auth/signin"]))}})}static \u0275fac=function(n){return new(n||i)(h(R),h(B),h(q))};static \u0275cmp=P({type:i,selectors:[["app-configurations"]],standalone:!0,features:[A],decls:34,vars:9,consts:[[1,"pt-28","px-4","sm:px-8","pb-12","bg-gray-50","min-h-screen"],[1,"bg-white","p-8","sm:p-10","rounded-2xl","shadow-lg","w-full","max-w-3xl","mx-auto"],[1,"text-2xl","font-semibold","text-center","text-gray-800","mb-10"],["class","mb-6 p-4 bg-green-100 text-green-700 rounded-md text-center",4,"ngIf"],["class","mb-6 p-4 bg-red-100 text-red-700 rounded-md text-center",4,"ngIf"],[1,"space-y-6",3,"ngSubmit","formGroup"],["for","name",1,"block","text-sm","font-medium","text-gray-700","mb-1"],[1,"relative"],["id","name","type","text","formControlName","name","placeholder","Seu nome",1,"w-full","px-4","py-2","border","border-gray-300","rounded-md","focus:ring-[#58A082]","focus:border-[#58A082]","transition","duration-150"],[1,"text-red-500"],["for","email",1,"block","text-sm","font-medium","text-gray-700","mb-1"],["id","email","type","email","formControlName","email","placeholder","Seu email",1,"w-full","px-4","py-2","border","border-gray-300","rounded-md","focus:ring-[#58A082]","focus:border-[#58A082]","transition","duration-150"],["for","cell",1,"block","text-sm","font-medium","text-gray-700","mb-1"],["id","cell","type","text","formControlName","cell","placeholder","(31) 98888-8888",1,"w-full","px-4","py-2","border","border-gray-300","rounded-md","focus:ring-[#58A082]","focus:border-[#58A082]","transition","duration-150"],[1,"flex","justify-end","items-center","gap-4","pt-4"],["type","button",1,"px-5","py-2","rounded-lg","bg-gray-500","text-white","font-medium","hover:bg-gray-600","transition-colors",3,"click"],["type","submit",1,"px-5","py-2","rounded-lg","bg-[#58A082]","text-white","font-medium","hover:bg-[#4a8870]","transition-colors","disabled:bg-gray-400","disabled:cursor-not-allowed",3,"disabled"],["class","mt-10 border-t pt-10 space-y-6",4,"ngIf"],[1,"mb-6","p-4","bg-green-100","text-green-700","rounded-md","text-center"],[1,"mb-6","p-4","bg-red-100","text-red-700","rounded-md","text-center"],[1,"mt-10","border-t","pt-10","space-y-6"],[1,"text-xl","font-semibold","text-center","text-gray-800","mb-6"],["for","currentPassword",1,"block","text-sm","font-medium","text-gray-700","mb-1"],["id","currentPassword","type","password","formControlName","currentPassword","placeholder","Senha atual",1,"w-full","px-4","py-2","border","border-gray-300","rounded-md","focus:ring-[#58A082]","focus:border-[#58A082]","transition","duration-150"],["for","newPassword",1,"block","text-sm","font-medium","text-gray-700","mb-1"],["id","newPassword","type","password","formControlName","newPassword","placeholder","Nova senha",1,"w-full","px-4","py-2","border","border-gray-300","rounded-md","focus:ring-[#58A082]","focus:border-[#58A082]","transition","duration-150"],[1,"flex","justify-end","pt-4"]],template:function(n,t){n&1&&(r(0,"main",0)(1,"section",1)(2,"h3",2),s(3," Configura\xE7\xF5es da Conta "),o(),b(4,O,2,1,"div",3)(5,W,2,1,"div",4),r(6,"form",5),v("ngSubmit",function(){return t.submitProfile()}),r(7,"div")(8,"label",6),s(9,"Nome"),o(),r(10,"div",7),c(11,"input",8),r(12,"small",9),s(13),o()()(),r(14,"div")(15,"label",10),s(16,"Email"),o(),r(17,"div",7),c(18,"input",11),r(19,"small",9),s(20),o()()(),r(21,"div")(22,"label",12),s(23,"Celular"),o(),r(24,"div",7),c(25,"input",13),r(26,"small",9),s(27),o()()(),r(28,"div",14)(29,"button",15),v("click",function(){return t.togglePasswordForm()}),s(30),o(),r(31,"button",16),s(32," Atualizar Perfil "),o()()(),b(33,K,21,4,"div",17),o()()),n&2&&(l(4),m("ngIf",t.successMessage),l(),m("ngIf",t.errorMessage),l(),m("formGroup",t.profileForm),l(7),p(t.getFieldError("name")),l(7),p(t.getFieldError("email")),l(7),p(t.getFieldError("cell")),l(3),w(" ",t.showPasswordForm?"Cancelar":"Alterar Senha"," "),l(),m("disabled",t.profileForm.invalid&&t.profileForm.touched),l(2),m("ngIf",t.showPasswordForm))},dependencies:[D,U,J,$,k,T,j,L,V,G],encapsulation:2})}return i})();export{ne as ConfigurationsComponent};
